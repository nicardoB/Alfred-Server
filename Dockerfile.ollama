# Ollama Docker setup for Railway deployment
FROM ollama/ollama:latest

# Set environment variables
ENV OLLAMA_HOST=0.0.0.0
ENV OLLAMA_PORT=11434

# Create ollama user and set permissions
RUN useradd -m -u 1000 ollama && \
    mkdir -p /home/ollama/.ollama && \
    chown -R ollama:ollama /home/ollama

# Switch to ollama user
USER ollama
WORKDIR /home/ollama

# Pre-pull a lightweight model
RUN ollama serve & \
    sleep 10 && \
    ollama pull llama3.1:8b && \
    pkill ollama

# Expose port
EXPOSE 11434

# Start Ollama service
CMD ["ollama", "serve"]
